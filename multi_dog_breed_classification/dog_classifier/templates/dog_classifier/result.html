<!-- templates/results.html -->
{% extends 'base.html' %}
{% block title %}Results â€” DogBreedAI{% endblock %}
{% block content %}
<h2 class="text-2xl font-semibold mb-6">Prediction Results</h2>
<div class="grid md:grid-cols-2 gap-6">
  <!-- Uploaded image & actions -->
  <div>
    <div class="bg-white rounded shadow overflow-hidden">
      <img src="{{ image_url }}" alt="Uploaded image" class="w-full">
      <div class="p-4">
        <p class="text-sm text-gray-500 mb-3">Uploaded at: {{ timestamp }}</p>
        <div class="flex space-x-3">
          <a href="{% url 'upload' %}" class="border border-gray-300 hover:bg-gray-100 py-1 px-3 rounded text-sm">Try another</a>
          
          <!-- Save to history form -->
          <form method="post" action="{% url 'save_history' %}">
            {% csrf_token %}
            <input type="hidden" name="image_path" value="{{ image_path }}">
            <input type="hidden" name="predictions_json" value="{{ predictions_json|escapejs }}">
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded text-sm">Save to history</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Predictions list -->
  <div>
    <h4 class="text-lg font-semibold mb-4">Top Predictions</h4>
    <div class="divide-y divide-gray-200 border border-gray-200 rounded">
      {% for pred in predictions %}
        <div class="flex justify-between items-center p-3">
          <div>
            <strong>{{ forloop.counter }}. {{ pred.label }}</strong>
            <div class="text-sm text-gray-500">Notes: {{ pred.note|default:"-" }}</div>
          </div>
          <div class="text-right">
            <div>{{ pred.confidence|floatformat:2 }}%</div>
            <div class="text-xs text-gray-500">{{ pred.rank_info }}</div>
          </div>
        </div>
      {% empty %}
        <div class="p-3 text-gray-500">No predictions available.</div>
      {% endfor %}
    </div>

    {% if explanation %}
      <hr class="my-4">
      <h5 class="font-semibold mb-2">Model explanation</h5>
      <pre class="text-sm bg-gray-100 p-3 rounded overflow-x-auto">{{ explanation }}</pre>
    {% endif %}
  </div>
</div>
{% endblock %}
